<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba CORS con NASA POWER</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }
        .widget-test {
            padding: 30px;
            background-color: #0d3b66; /* Un color NASA */
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        h1 { font-size: 3rem; margin: 10px 0; }
        p { font-size: 1.2rem; }
        .estado { color: #ffeb3b; font-weight: bold; }
    </style>
</head>
<body>

    <div class="widget-test">
        <h2>Temperatura de NASA POWER</h2>
        <p>UbicaciÃ³n: Ciudad de MÃ©xico (19.43, -99.13)</p>
        <h1 id="temperatura">Cargando...</h1>
        <p class="estado" id="estado-cors">Revisando conexiÃ³n...</p>
    </div>

    <script>
        // Coordenadas de la Ciudad de MÃ©xico
        const LATITUDE = 19.4326;
        const LONGITUDE = -99.1332;
        
        // Formatea la fecha de hoy como YYYYMMDD
        //const today = new Date();
        //const yyyymmdd = today.toISOString().slice(0, 10).replace(/-/g, '');
         const yyyymmdd = '20250925';
        // Construye la URL de la API de NASA POWER para obtener la temperatura (T2M)
        // Comunidades de energÃ­a o agroclimatologÃ­a (AG) son comunes para T2M
        const NASA_POWER_URL = `https://power.larc.nasa.gov/api/temporal/daily/point?parameters=T2M&community=AG&longitude=${LONGITUDE}&latitude=${LATITUDE}&start=${yyyymmdd}&end=${yyyymmdd}&format=JSON`;

        const tempElement = document.getElementById('temperatura');
        const statusElement = document.getElementById('estado-cors');

        function obtenerTemperaturaNASA() {
            statusElement.textContent = 'Intentando conectar a la API de NASA...';

            fetch(NASA_POWER_URL)
                .then(response => {
                    // Aunque la solicitud falle por CORS, esta promesa A VECES se resuelve
                    // (si el error ocurre despuÃ©s del "vuelo previo"), pero la respuesta.ok
                    // probablemente sea falsa o simplemente no se pueda acceder al contenido.
                    
                    // Si el error CORS es el que esperamos, el cÃ³digo saltarÃ¡ directamente al .catch.
                    if (!response.ok) {
                        // Intentamos procesar la respuesta, pero si falla por CORS...
                        // el cÃ³digo JavaScript no podrÃ¡ leer el cuerpo de la respuesta.
                        console.error("Respuesta HTTP no OK. Esto podrÃ­a ser CORS.");
                        statusElement.textContent = 'Error: Respuesta HTTP inicial no satisfactoria.';
                    }
                    return response.json();
                })
                .then(data => {
                    // Si llegamos aquÃ­, Â¡el CORS NO fallÃ³! (Lo cual es improbable)
                    
                    // Extraer la temperatura T2M
                    const tempKelvin = data.properties.parameter.T2M[yyyymmdd];
                    // Convertir a Celsius (Kelvin - 273.15)
                    const tempCelsius = (tempKelvin).toFixed(1); 

                    tempElement.textContent = `${tempCelsius}Â°C`;
                    statusElement.textContent = 'Ã‰xito: Datos obtenidos (Â¡CORS NO fallÃ³, muy inusual!)';
                })
                .catch(error => {
                    // Este es el punto de falla esperado debido a CORS.
                    tempElement.textContent = '??Â°C';
                    console.error('--- ERROR CORS ESPERADO ---');
                    console.error('El navegador bloqueÃ³ la solicitud o el acceso a la respuesta:');
                    console.error(error);
                    statusElement.textContent = 'ðŸ”´ ERROR CORS: Revisa la Consola del Navegador.';
                    statusElement.style.color = 'red';
                });
        }

        document.addEventListener('DOMContentLoaded', obtenerTemperaturaNASA);
    </script>
</body>
</html>